### 14 예외


- 자바스크립트 컴파일러는 컴파일하는 모든 함수에 대한 캐치맵(catchmap)을 만든다
    - catchmap: 함수 몸체의 명령어 위치와 이들이 처리하는 catch 문을 연결해 준다
    - 프로그램이 정상으로 동작할 때는 캐치맵이 쓰일 일이 없다
    - throw 문이 실행되면 예외가 발생하고 현재 함수에 대한 캐치맵을 참조한다
    - 지정된 catch 절이 있으면 실행되고, 없으면 함수를 호출한 곳을 찾는다
    - 이 과정을 계속 반복해서 catch 절을 찾을 때까지 가상의 호출 스택을 타고 내려간다
    - 호출 스택이 더 이상 없으면 처리할 수 없는 예외(uncaught exception)가 된다

- 하나의 함수에서 try를 두 번 이상 쓰지 말자
- 예외 처리가 신경 써야 할 중요한 점 하나는 제대로 동작하는 프로그램에는 성능 패널티가 없어야 한다
- 예외 처리를 잘못 쓰는 가장 흔한 경우는 정상적인 결과를 처리할 때도 쓰는 것이다
    - ex. 파일을 읽는 함수에서 파일을 찾을 수 없는 것은 예외가 아니다
- 예외 처리는 예상하지 못한 문제를 처리할 때만 사용 되어야 한다

- 예외 처리는 스택을 거꾸로 되감으면서 진행된다 (예외로 발생된 값은 스택의 더 아래쪽에 있는 함수 호출로 전달 된다)
- 스택이 아래에서 위로 쌓인다는 점을 생각하면, 결국 가장 처음 함수를 호출한 곳까지 전달 된다
- 비동기 프로그래밍에서 스택은 매 회 비워진다
- 더 이상 존재하지 않는 스택을 거슬러 가서 예외 값을 전달할 수가 없다

```jsx
// (X) setTimeout에 넘겨진 콜백에서 에러 발생 시, try..catch를 이미 떠난 후 실행되어 에러 발생
try {
  setTimeout(() => {
    throw new Error('에러!');
  });
} catch (e) {
  console.error(e);
}
// (O) 비동기 콜백 내에 try...catch 작성
setTimeout(() => {
  try {
    throw new Error('에러!');
  } catch (e) {
    console.error(e);
  }
});
```